---
const hostname = typeof window !== "undefined"
  ? window.location.hostname.replace("www.", "")
  : "kumaryeri.com";

let sites = [];

try {
  const response = await fetch("https://sitesconfig.pages.dev/sites.json");
  const data = await response.json();

  sites = data
    .map(site => {
      const order = site.visibilityMap?.[hostname] ?? site.visibilityMap?.default;
      if (order === undefined || order === false) return null;
      return { ...site, order };
    })
    .filter(Boolean)
    .sort((a, b) => a.order - b.order);
} catch (err) {
  console.error("❌ JSON yüklenemedi:", err);
}
---

<section class="space-y-6">
  {sites.map(site => (
    <a
      href={site.ref}
      target="_blank"
      rel="noopener noreferrer"
      class="flex flex-col gap-3 p-4 rounded-xl border border-gray-700 bg-gray-900 hover:bg-gray-800 transition"
    >
      <div class="flex items-center gap-4">
        <img
          src={site.icon}
          alt={site.name}
          loading="lazy"
          class="w-14 h-14 object-contain rounded-md bg-white p-1"
        />

        <div>
          <h3 class="text-lg font-bold text-white">{site.name}</h3>
          <p class="text-sm text-green-400 font-medium">{site.bonus}</p>
        </div>
      </div>

      <div class="flex items-center gap-2 text-sm text-yellow-400 font-medium">
        <span>⭐ {site.rating}</span>
        <span class="text-gray-400">({site.votes} oy)</span>
      </div>

      <div class="flex flex-wrap gap-2 mt-1">
        {site.features.map((feature, i) => (
          <span class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded-full border border-gray-600" key={i}>
            {feature}
          </span>
        ))}
      </div>
    </a>
  ))}
</section>
