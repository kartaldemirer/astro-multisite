---
// Astro component
const hostname = typeof window !== "undefined"
  ? window.location.hostname.replace("www.", "")
  : "kumaryeri.com";

let sites = [];
const url = "https://sitesconfig.pages.dev/"

try {
  const response = await fetch(url + "sites.json");
  const data = await response.json();

  sites = data
    .map((site: any) => {
      const order = site.visibilityMap?.[hostname] ?? site.visibilityMap?.default;
      if (order === undefined || order === false) return null;
      return { ...site, order };
    })
    .filter(Boolean)
    .sort((a, b) => a.order - b.order);
} catch (err) {
  console.error("❌ JSON yüklenemedi:", err);
}
---

<section id="bonuslar" class="flex flex-col gap-6 scroll-mt-20">
  {sites.map((site: any) => (
    <article
      itemscope
      itemtype="https://schema.org/Offer"
      class="flex flex-col sm:flex-row items-center gap-4 border border-gray-700 bg-[#0c0f1a] rounded-2xl p-5 hover:shadow-xl transition-all duration-300"
    >
      <!-- Logo -->
      <div class="w-48 h-48 flex-shrink-0 flex items-center justify-center bg-gray-800 rounded-lg p-2">
        <img
          src={"https://sitesconfig.pages.dev" + site.icon || "https://via.placeholder.com/64"}
          alt={site.name}
          class="w-full h-full object-contain"
          itemprop="image"
        />
      </div>

      <!-- İçerik -->
      <div class="flex flex-col justify-between w-full gap-2">
        <!-- Başlık ve Oy -->
        <div class="flex justify-between items-center gap-2 flex-wrap">
          <h3 class="text-xl sm:text-2xl font-bold text-white" itemprop="name">{site.name}</h3>
          <span class="text-yellow-400 text-sm sm:text-base flex items-center gap-1">
            ⭐ {site.rating} <span class="text-gray-400">({site.votes} oy)</span>
          </span>
        </div>

        <!-- Bonus -->
        <p class="text-green-400 text-sm sm:text-base font-semibold" itemprop="description">
          {site.bonus}
        </p>

        <!-- Etiketler -->
        <div class="flex flex-wrap gap-2">
          {site.features.map((feature: string, i: number) => (
            <span key={i} class="text-xs sm:text-sm bg-blue-900/40 text-blue-100 px-3 py-1 rounded-full border border-blue-700">
              {feature}
            </span>
          ))}
        </div>

        <!-- Buton -->
        <div class="mt-2">
          <a
            href={site.ref}
            target="_blank"
            rel="noopener noreferrer"
            itemprop="url"
            class="inline-block text-yellow-400 text-sm sm:text-base font-medium hover:underline"
          >
            Detayları Gör
          </a>
        </div>

        <!-- SEO meta -->
        <meta itemprop="priceCurrency" content="TRY" />
        <meta itemprop="price" content="0.00" />
      </div>
    </article>
  ))}

  <article
  class="flex flex-col sm:flex-row items-center gap-4 border-2 border-dashed border-yellow-500 bg-[#1f1f1f] rounded-2xl p-5 text-center hover:shadow-xl transition-all duration-300"
  aria-hidden="true"
>
  <!-- Simge -->
  <div class="w-20 h-20 flex-shrink-0 flex items-center justify-center bg-yellow-900/10 rounded-lg p-2">
    <svg class="w-10 h-10 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 13V6a1 1 0 00-1-1h-5.586a1 1 0 00-.707.293l-5.414 5.414a1 1 0 00-.293.707V18a1 1 0 001 1h11a1 1 0 001-1v-5z" />
    </svg>
  </div>

  <!-- İçerik -->
  <div class="flex flex-col items-start sm:items-start justify-center w-full gap-2">
    <h3 class="text-xl sm:text-2xl font-bold text-yellow-400">
      Bu alana reklam verebilirsiniz
    </h3>
    <p class="text-gray-300 text-sm sm:text-base">
      Casinonuzu tanıtın, görünürlüğünüzü artırın. İletişim: <a href="mailto:info@kumaryeri.com" class="underline text-yellow-300">info@kumaryeri.com</a>
    </p>
  </div>
</article>

</section>

