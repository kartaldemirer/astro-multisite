---
// Astro component
const hostname = typeof window !== "undefined"
  ? window.location.hostname.replace("www.", "")
  : "kumaryeri.com";

let sites = [];

try {
  const response = await fetch("https://sitesconfig.pages.dev/sites.json");
  const data = await response.json();

  sites = data
    .map((site: any) => {
      const order = site.visibilityMap?.[hostname] ?? site.visibilityMap?.default;
      if (order === undefined || order === false) return null;
      return { ...site, order };
    })
    .filter(Boolean)
    .sort((a, b) => a.order - b.order);
} catch (err) {
  console.error("❌ JSON yüklenemedi:", err);
}
---

<section id="bonuslar" class="flex flex-col gap-6 scroll-mt-20">
  {sites.map((site: any) => (
    <a
      href={site.ref}
      target="_blank"
      rel="noopener noreferrer"
      class={`w-full p-4 rounded-xl border transition duration-300 flex flex-col sm:flex-row gap-4
        ${site.slotSize === 2 
          ? 'min-h-[280px] bg-yellow-900/20 border-yellow-500 shadow-lg'
          : 'min-h-[140px] bg-[#0a0f1c] hover:bg-[#12182b] border-gray-700'
        }`}
    >
      <div class="flex-shrink-0 flex items-center justify-center">
        <img
          src={site.icon || "https://via.placeholder.com/64"}
          alt={site.name}
          class="w-24 h-24 object-contain bg-white rounded-md p-2"
        />
      </div>

      <div class="flex flex-col justify-between w-full">
        <div class="flex items-center justify-between">
          <h3 class={`font-bold text-white ${site.slotSize === 2 ? 'text-2xl' : 'text-lg'}`}>
            {site.name}
          </h3>
          <span class="text-yellow-400">
            ⭐ {site.rating} <span class="text-gray-400">({site.votes} oy)</span>
          </span>
        </div>

        <p class="text-green-400 text-sm mt-1 font-medium">{site.bonus}</p>

        <div class="flex flex-wrap gap-2 mt-2">
          {site.features.map((feature: string, i: number) => (
            <span key={i} class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded-full border border-gray-600">
              {feature}
            </span>
          ))}
        </div>
      </div>
    </a>
  ))}
</section>



